<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mom Physic - Đơn hàng của tôi</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
  <style>
    body { background-color: #0b021c; color: #fff; }
    .navbar, footer { background-color: #150035; }
    .text-gold { color: #e6c300 !important; }
    .border-gold { border-color: #e6c300 !important; }
    .btn-gold {
      background-color: #e6c300;
      color: #150035;
      border: none;
      transition: all 0.3s ease;
    }
    .btn-gold:hover {
      background-color: #f1d500;
      transform: translateY(-2px);
      color: #fff;
    }
    .table-dark-purple {
      background-color: #1c093a;
      border: 1px solid #3d1a78;
      color: #fff;
    }
    .table-dark-purple thead {
      background-color: #2a0a52;
      color: #e6c300;
    }
    .table-dark-purple tbody tr:hover {
      background-color: #2d0a5c;
      transition: background 0.3s ease;
    }
    .badge { font-size: 0.9rem; }
    .navbar-nav .nav-link {
      font-weight: 500;
      transition: color 0.3s ease;
    }
    .navbar-nav .nav-link:hover { color: #fff !important; }
    footer {
      border-top: 1px solid #e6c300;
      color: #e6c300;
    }
    .search-bar input::placeholder { color: #bbb; }
  </style>
</head>
<body>

<!-- Navbar -->
<nav class="navbar navbar-expand-lg navbar-dark py-3"
     style="background: linear-gradient(90deg, #150035, #2d007a); border-bottom: 1px solid #e6c300;">
  <div class="container">
    <a class="navbar-brand d-flex align-items-center gap-2" href="/">
      <img src="https://cdn-icons-png.flaticon.com/512/1040/1040230.png" alt="logo" width="40">
      <span class="fw-bold text-gold fs-4 mb-0">Mom Physic</span>
    </a>

    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse justify-content-end" id="navbarNav">
      <ul class="navbar-nav align-items-lg-center mb-2 mb-lg-0">
        <li class="nav-item mx-2">
          <a class="nav-link text-gold" href="/products"><i class="bi bi-box-seam fs-5"></i></a>
        </li>

        <th:block th:if="${session.account == null}">
          <li class="nav-item mx-2">
            <a class="nav-link text-gold" href="/login"><i class="bi bi-box-arrow-in-right fs-5"></i></a>
          </li>
        </th:block>

        <th:block th:if="${session.account != null}">
          <li class="nav-item mx-2">
            <a class="nav-link text-gold" href="/cart"><i class="bi bi-cart3 fs-5"></i></a>
          </li>
          <li class="nav-item mx-2">
            <a class="nav-link text-gold" href="/orders"><i class="bi bi-bag-check fs-5"></i></a>
          </li>
          <li class="nav-item mx-2">
            <a class="nav-link text-gold" href="/wishlist"><i class="bi bi-heart fs-5"></i></a>
          </li>

          <li class="nav-item dropdown mx-2">
            <a class="nav-link dropdown-toggle p-0" href="#" id="userDropdown" role="button" data-bs-toggle="dropdown">
              <img th:if="${session.account.photo != null}"
                   th:src="@{${session.account.photo}}" alt="avatar"
                   class="rounded-circle border border-gold"
                   style="width: 36px; height: 36px; object-fit: cover;">
              <i th:if="${session.account.photo == null}" class="bi bi-person-circle fs-3 text-warning"></i>
            </a>
            <ul class="dropdown-menu dropdown-menu-dark dropdown-menu-end" aria-labelledby="userDropdown">
              <li><a class="dropdown-item d-flex align-items-center gap-2" href="/account">
                <i class="bi bi-person"></i><span>Thông tin tài khoản</span></a></li>
              <li><hr class="dropdown-divider"></li>
              <li><a class="dropdown-item d-flex align-items-center gap-2" href="/logout">
                <i class="bi bi-box-arrow-right"></i><span>Đăng xuất</span></a></li>
            </ul>
          </li>
        </th:block>
      </ul>

      <!-- Search -->
      <form class="d-flex align-items-center ms-lg-3 mt-3 mt-lg-0">
        <div class="d-flex align-items-center rounded-pill border border-gold px-3 py-1 bg-transparent">
          <input type="text" class="form-control bg-transparent text-light border-0 shadow-none" placeholder="Tìm sản phẩm...">
          <select class="form-select bg-transparent text-light border-0 shadow-none w-auto">
            <option selected>Danh mục</option>
            <option>Gundam</option>
            <option>Marvel</option>
            <option>Ô tô</option>
            <option>Collectibles</option>
          </select>
        </div>
        <a href="#" class="btn btn-gold rounded-pill ms-2 px-3 d-flex align-items-center gap-1">
          <i class="bi bi-search"></i>
        </a>
      </form>
    </div>
  </div>
</nav>

<!-- Content -->
<div class="container my-5">
  <h3 class="fw-bold text-gold mb-4"><i class="bi bi-bag-check"></i> Đơn hàng của tôi</h3>

  <div class="table-responsive">
    <table class="table table-dark-purple table-bordered align-middle text-center">
      <thead>
        <tr>
          <th>Mã đơn hàng</th>
          <th>Ngày đặt</th>
          <th>Sản phẩm</th>
          <th>Tổng tiền</th>
          <th>Trạng thái</th>
        </tr>
      </thead>
      <tbody>
        <!-- ✅ Vòng lặp hiển thị dữ liệu đơn hàng -->
        <tr th:each="order : ${orders}">
          <td th:text="'#DH' + ${order.id}">#DH001</td>
          <td th:text="${#dates.format(order.createdDate, 'dd/MM/yyyy')}">01/10/2025</td>
          <td>
            <span th:each="detail, iterStat : ${order.orderDetails}">
              <span th:text="${detail.productId.name}"></span>
              <span th:if="${!iterStat.last}">, </span>
            </span>
          </td>
          <td class="text-gold fw-bold" 
              th:text="${#numbers.formatDecimal(order.total, 0, 'COMMA', 0, 'POINT')} + '₫'">1.200.000₫</td>
          <td>
            <span th:switch="${order.status}">
              <span th:case="0" class="badge bg-warning text-dark"><i class="bi bi-hourglass-split"></i> Đang xử lý</span>
              <span th:case="1" class="badge bg-info text-dark"><i class="bi bi-check2-circle"></i> Đã xác nhận</span>
              <span th:case="2" class="badge bg-primary"><i class="bi bi-truck"></i> Đang giao</span>
              <span th:case="3" class="badge bg-success"><i class="bi bi-check-circle"></i> Hoàn thành</span>
              <span th:case="4" class="badge bg-danger"><i class="bi bi-x-circle"></i> Đã hủy</span>
            </span>
          </td>
        </tr>

        <!-- Nếu không có đơn hàng -->
        <tr th:if="${#lists.isEmpty(orders)}">
          <td colspan="5" class="text-center text-muted py-4">
            <i class="bi bi-emoji-frown fs-4 text-gold"></i> 
            <br>Chưa có đơn hàng nào.
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="text-center mt-4">
    <a href="/products" class="btn btn-gold rounded-pill px-4">
      <i class="bi bi-arrow-left"></i> Tiếp tục mua sắm
    </a>
  </div>
</div>

<footer class="text-center py-4 border-top border-warning">
  <p class="mb-0 text-gold">© 2025 Mom Physic. All Rights Reserved</p>
</footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
