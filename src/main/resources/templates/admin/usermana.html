<!doctype html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Mom Physic - Quản lý người dùng</title>
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css"
	rel="stylesheet">
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
	rel="stylesheet">
<style>
body {
	background: linear-gradient(135deg, #150035, #2d007a);
	color: #fff;
	min-height: 100vh;
}

.navbar {
	background: linear-gradient(90deg, #150035, #2d007a);
	border-bottom: 1px solid #ffd700;
}

.card {
	background-color: rgba(255, 255, 255, 0.05);
	border: 1px solid rgba(255, 215, 0, 0.3);
	border-radius: 15px;
	backdrop-filter: blur(8px);
}

.card h6, label, th {
	color: #ffd700;
}

.form-control, .form-select {
	background-color: rgba(255, 255, 255, 0.1);
	color: white;
	border: 1px solid rgba(255, 215, 0, 0.3);
}

.form-control::placeholder {
	color: rgba(255, 255, 255, 0.6);
}

.form-control:focus, .form-select:focus {
	box-shadow: 0 0 5px #ffd700;
	border-color: #ffd700;
}

.btn-gold {
	background: linear-gradient(90deg, #ffd700, #ffae00);
	color: #150035;
	font-weight: 600;
	border: none;
	transition: 0.3s;
}

.btn-gold:hover {
	background: linear-gradient(90deg, #ffae00, #ffd700);
	transform: scale(1.05);
}

.footer {
	background: linear-gradient(90deg, #150035, #2d007a);
	border-top: 1px solid rgba(255, 215, 0, 0.3);
	color: rgba(255, 255, 255, 0.85);
}

.preview-img {
	width: 100px;
	height: 100px;
	border-radius: 10px;
	object-fit: cover;
	border: 2px solid #ffd700;
}
</style>
</head>
<body>

	<!-- Navbar -->
	<nav class="navbar navbar-expand-lg navbar-dark px-4 py-3">
		<div class="container-fluid">
			<a class="navbar-brand d-flex align-items-center" href="/"> <img
				src="https://cdn-icons-png.flaticon.com/512/1040/1040230.png"
				alt="logo" width="45" class="me-2"> <span
				class="fw-bold text-warning fs-4">Mom Physic</span>
			</a>
		</div>
	</nav>

	<div class="container py-5">

		<div class="d-flex justify-content-between align-items-center mb-4">
			<h2 class="text-warning mb-0">
				<i class="bi bi-people"></i> Quản lý người dùng
			</h2>
			<a href="/stats" class="btn btn-gold"><i
				class="bi bi-arrow-left-circle me-1"></i> Về menu Admin</a>
		</div>

		<!-- Bảng người dùng -->
		<div class="card shadow mb-4">
			<div class="card-body p-0">
				<table
					class="table table-dark table-hover mb-0 text-center align-middle">
					<thead>
						<tr>
							<th>ID</th>
							<th>Hình</th>
							<th>Họ tên</th>
							<th>Email</th>
							<th>Giới tính</th>
							<th>Vai trò</th>
							<th>Điện thoại</th>
							<th>Địa chỉ</th>
							<th>Ngày sinh</th>
							<th>Trạng thái</th>
							<th>Thao tác</th>
						</tr>
					</thead>
					<tbody>
						<tr th:each="acc : ${accounts}">
							<td th:text="${acc.id}"></td>
							<td><img th:src="@{${acc.photo}}" width="45"
								class="rounded-circle border border-warning p-1"></td>

							<td th:text="${acc.fullName}"></td>
							<td th:text="${acc.email}"></td>
							<td th:text="${acc.gender ? 'Nam' : 'Nữ'}"></td>
							<td th:text="${acc.role ? 'Admin' : 'User'}"></td>
							<td th:text="${acc.phone}"></td>
							<td th:text="${acc.address}"></td>
							<td th:text="${#dates.format(acc.birthDay, 'dd/MM/yyyy')}"></td>
							<td><span
								th:classappend="${acc.actived} ? 'badge bg-success' : 'badge bg-danger'"
								th:text="${acc.actived ? 'Active' : 'Locked'}"></span></td>
							<td><a th:href="@{'/user-mana/update/' + ${acc.id}}"
								class="btn btn-sm btn-primary me-1" data-bs-toggle="modal"
								data-bs-target="#editModal"
								th:attr="data-id=${acc.id},
            data-fullname=${acc.fullName},
            data-phone=${acc.phone},
            data-email=${acc.email},
            data-address=${acc.address},
            data-photo=${acc.photo}">
									<i class="bi bi-pencil-square"></i>
							</a> <!-- Ẩn hai nút này nếu role = admin --> <a th:if="${!acc.role}"
								th:href="@{'/user-mana/lock/' + ${acc.id}}"
								class="btn btn-sm btn-warning me-1"> <i class="bi bi-lock"></i>
							</a> <a th:if="${!acc.role}"
								th:href="@{'/user-mana/unlock/' + ${acc.id}}"
								class="btn btn-sm btn-success me-1"> <i class="bi bi-unlock"></i>
							</a></td>
						</tr>
					</tbody>
				</table>
			</div>
		</div>

	</div>
	<!-- ✅ Modal sửa -->
	<div class="modal fade" id="editModal" tabindex="-1">
		<div class="modal-dialog">
			<div class="modal-content"
				style="background-color: #1a1a2e; color: white; border: 1px solid #ffd700;">

				<div class="modal-header border-warning">
					<h5 class="modal-title text-warning">
						<i class="bi bi-pencil-square me-2"></i> Sửa thông tin người dùng
					</h5>
					<button type="button" class="btn-close btn-close-white"
						data-bs-dismiss="modal"></button>
				</div>

				<!-- ✅ Form cập nhật -->
				<form id="editForm" method="post" enctype="multipart/form-data">
					<div class="modal-body">
						<input type="hidden" id="userId" name="id">

						<div class="mb-3">
							<label class="form-label text-warning">Họ tên</label> <input
								type="text" id="fullName" name="fullName"
								class="form-control bg-dark text-light border-warning">
						</div>

						<div class="mb-3">
							<label class="form-label text-warning">Số điện thoại</label> <input
								type="text" id="phone" name="phone"
								class="form-control bg-dark text-light border-warning">
						</div>

						<div class="mb-3">
							<label class="form-label text-warning">Email</label> <input
								type="text" id="email" name="email"
								class="form-control bg-dark text-light border-warning">
						</div>

						<div class="mb-3">
							<label class="form-label text-warning">Địa chỉ</label> <input
								type="text" id="address" name="address"
								class="form-control bg-dark text-light border-warning">
						</div>

						<div class="mb-3 text-center">
							<label class="form-label text-warning">Ảnh đại diện</label> <input
								type="file" name="file" id="photoFile"
								class="form-control bg-dark text-light border-warning"
								accept="image/*"> <img id="photoPreview"
								class="preview-img mt-3" src="#" alt="Xem trước ảnh"
								style="display: none; max-width: 120px; border-radius: 10px;">
						</div>
					</div>

					<div class="modal-footer border-warning">
						<button type="button" class="btn btn-secondary"
							data-bs-dismiss="modal">Hủy</button>
						<button type="submit" class="btn btn-gold">
							<i class="bi bi-check-circle"></i> Cập nhật
						</button>
					</div>
				</form>
			</div>
		</div>
	</div>

	<footer class="footer text-center py-4 mt-5">
		<small>© 2025 <span class="text-warning">Mom Physic</span> |
			Figure & Model Store
		</small>
	</footer>

	<script>
document.addEventListener("DOMContentLoaded", () => {
  const editModal = document.getElementById('editModal');

  editModal.addEventListener('show.bs.modal', event => {
    const button = event.relatedTarget;

    // Lấy dữ liệu từ button
    const id = button.getAttribute('data-id');
    const fullName = button.getAttribute('data-fullname');
    const phone = button.getAttribute('data-phone');
    const email = button.getAttribute('data-email');
    const address = button.getAttribute('data-address');
    const photo = button.getAttribute('data-photo');

    // Gán giá trị vào form
    document.getElementById('userId').value = id;
    document.getElementById('fullName').value = fullName || '';
    document.getElementById('phone').value = phone || '';
    document.getElementById('email').value = email || '';
    document.getElementById('address').value = address || '';

    // Cập nhật action của form
    const form = document.getElementById('editForm');
    form.action = '/user-mana/update/' + id;

    // Hiển thị ảnh hiện tại
    const preview = document.getElementById('photoPreview');
    if (photo) {
      preview.src = photo;
      preview.style.display = 'block';
    } else {
      preview.style.display = 'none';
    }
  });

  // Xem trước ảnh mới khi chọn file
  document.getElementById('photoFile').addEventListener('change', event => {
    const [file] = event.target.files;
    const preview = document.getElementById('photoPreview');
    if (file) {
      preview.src = URL.createObjectURL(file);
      preview.style.display = 'block';
    } else {
      preview.style.display = 'none';
    }
  });
});
</script>

	<script
		src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
	`

</body>
</html>
